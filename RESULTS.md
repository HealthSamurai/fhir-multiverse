# Скоуп 

Проверяем все решение на связке STU3 3.0.2 и R4 4.0.1

# Известные проблемы маппинга

Проблемы между версиями, которые отражены в стандарте (http://hl7.org/fhir/diff.html):

- Добавление или удаление элементов в рамках одного элемента
- Изменение имени элемента
- Изменения в размерности элементов (cardinality)
- Изменения в типах данных элементов (в т.ч. появление новых типов данных)
- Изменения в справочниках (содержание ValueSet)
- Изменения в биндингах справочников
- Изменения значения is-modifier
- Изменения в расширениях (extension) 
- Изменения в профилях 
- (До версии R3) Значение элемента по умолчанию

Изменения между версиями, которые мы знаем, но явно не отражены в стандарте:

- Изменение search api между версиями
- Миграция полей из одного ресурса в другой
- Объединение нескольких ресурсов в один
- Разбиение ресурса в несколько ресурсов (Practitioner (DSTU2) -> Practitioner(STU3), PractitionerRole(STU3))

# Критерий тестирования в стандарте

Какой подход к тестированию предлагает стандарт:

Для каждого ресурса их примеров в R3 (STU3):

1. Берется ресурс в формате R3
1. Применяется трансформация в R4
1. Полученный ресурс проверяется на соответствие спецификации R4
1. Применяется обратная трансформация в R3
1. Проверяется исходный ресурс и ресурс после конвертации и проверяется на соответствие

Не покрывается стандартом:

- Тестирование сложных сценариев (несколько ресурсов в несколько ресурсов) 
- Профилирование ресурсов
- Изменение valueSet

# Наши подход к тестированию

TODO: Для каждого типа проблемы сгенерировать отдельный критерий проверки. На время хакатона используем упрощенные критерии.

## Первый этап

Используем подход тестирования из раздела (Критерий тестирования в стандарте) для отдельных ресурсов из раздела "Базовый тестовый сет"

Критерий успешности: Конвертация ресурса STU3 -> R4 -> STU3 дает такой же ресурс как до конвертации (повторяем тестирование как в стандарте)

Метрика1: Число конвертации в валидный R4 ресурс от всех попыток
Метрика2: Число успешных полных конвертации от всех попыток

## Второй этап

Создаем сет связанных ресурсов "Базовый тестовый сет", состоящий из пациента, приема и врача, которые связанны друг с другом, через Reference. 

Критерий успешности 1: Конвертация R4->R3 сохраняет ссылки между ресурсами
Критерий успешности 2: Конвертация R3->R4->R3 возвращает группу ресурсов в исходное состояние

Метрика1: Число конвертации в валидую R3 группу ресурсов от всех попыток
Метрика2: Число успешных полных конвертации от всех попыток

## Третий этап 

Повторяет подход первого этапа, но на автогенерируемых ресурсах

## Четвертый этап 

Повторяет подход второго этапа, но на автогенерируемых ресурсах

# Базовый тестовый сет

Используется для проверки конвертации сценария конвертации связанных ресурсов:


